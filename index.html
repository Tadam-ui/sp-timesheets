<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SP Timesheets</title>

<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#ff6b6b,#ff8787);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
margin:0;
}

.app{
background:white;
padding:25px;
border-radius:20px;
width:360px;
text-align:center;
}

button{
padding:10px 18px;
border:none;
border-radius:30px;
cursor:pointer;
margin:6px;
}

.clock-in{background:#2ecc71;color:white;}
.clock-out{background:#e74c3c;color:white;}

textarea{width:100%;height:60px;}

table{
width:100%;
font-size:12px;
margin-top:10px;
border-collapse:collapse;
}

td,th{
border-bottom:1px solid #ddd;
padding:4px;
}

input.table-input{
width:70px;
font-size:11px;
}
</style>
</head>

<body>

<div class="app">

<h3 id="name"></h3>

<p>Today Hours: <span id="today">0:00</span></p>

<button id="clockBtn" class="clock-in"
onclick="app.toggleClock()">
<span id="clockText">Clock In</span>
</button>

<textarea id="notes" placeholder="Job notes..."></textarea>

<button onclick="app.toggleTable()">View Timesheet</button>

<div id="tableWrap" style="display:none">

<h4>Weekly / Monthly</h4>

<table>
<thead>
<tr>
<th>Date</th>
<th>Start</th>
<th>End</th>
<th>Hrs</th>
<th>Notes</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

</table>
</div>

</div>

<script>

const GOOGLE_SCRIPT_URL =
'https://script.google.com/macros/s/AKfycbxvRWVHRf_diTDdZ8qp_RPXj4n97SZNb5ePPuALqdBWgH0L1KOxN3UzoYif2Ly5eiOy-Q/exec';

class Timesheet{

constructor(){
this.user={name:'Paul Read'};
this.entry=null;
this.timer=null;
this.history=JSON.parse(localStorage.getItem('history')||'[]');

document.getElementById('name').innerText=this.user.name;
}

/* CLOCK */

toggleClock(){
if(this.entry) this.clockOut();
else this.clockIn();
}

clockIn(){

this.entry={start:new Date()};

document.getElementById('clockBtn').className='clock-out';
document.getElementById('clockText').innerText='Clock Out';

this.timer=setInterval(()=>this.updateClock(),1000);
}

clockOut(){

clearInterval(this.timer);

const end=new Date();
const notes=document.getElementById('notes').value;

const hours=((end-this.entry.start)/36e5);

const row={
date:end.toISOString().split('T')[0],
start:this.entry.start.toLocaleTimeString('en-GB'),
end:end.toLocaleTimeString('en-GB'),
hours:hours.toFixed(2),
notes:notes
};

this.history.push(row);
localStorage.setItem('history',JSON.stringify(this.history));

fetch(GOOGLE_SCRIPT_URL,{
method:'POST',
body:JSON.stringify(row)
});

this.entry=null;
document.getElementById('notes').value='';
document.getElementById('today').innerText='0:00';
this.render();
}

/* LIVE CLOCK */

updateClock(){

const now=new Date();
const hrs=((now-this.entry.start)/36e5);

const h=Math.floor(hrs);
const m=Math.floor((hrs-h)*60);

document.getElementById('today').innerText=
`${h}:${m.toString().padStart(2,'0')}`;
}

/* TABLE */

toggleTable(){
const wrap=document.getElementById('tableWrap');
wrap.style.display=
wrap.style.display==='none'?'block':'none';

this.render();
}

render(){

const tbody=document.getElementById('tbody');
tbody.innerHTML='';

this.history.forEach((r,i)=>{

tbody.innerHTML+=`
<tr>

<td>${r.date}</td>

<td>
<input class="table-input"
value="${r.start}"
onchange="app.edit(${i},'start',this.value)">
</td>

<td>
<input class="table-input"
value="${r.end}"
onchange="app.edit(${i},'end',this.value)">
</td>

<td>${r.hours}</td>

<td>
<input class="table-input"
value="${r.notes}"
onchange="app.edit(${i},'notes',this.value)">
</td>

</tr>`;
});
}

/* EDIT */

edit(i,field,val){
this.history[i][field]=val;
localStorage.setItem('history',
JSON.stringify(this.history));
}

}

const app=new Timesheet();

</script>

</body>
</html>
