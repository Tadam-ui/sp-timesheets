<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SP Timesheets</title>

<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#ff6b6b,#ff8787);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
margin:0;
}

.app{
background:white;
padding:25px;
border-radius:20px;
width:340px;
text-align:center;
}

button{
padding:12px 20px;
border:none;
border-radius:40px;
cursor:pointer;
margin-top:10px;
}

.clock-in{background:#2ecc71;color:white;}
.clock-out{background:#e74c3c;color:white;}

.hidden{display:none;}

textarea{
width:100%;
height:60px;
margin-top:10px;
}

table{
width:100%;
font-size:12px;
margin-top:10px;
border-collapse:collapse;
}

td,th{
border-bottom:1px solid #ddd;
padding:4px;
}
</style>
</head>

<body>

<!-- LOGIN -->

<div id="login" class="app">
<h2>SP Timesheets</h2>
<input id="pin" placeholder="Enter PIN"><br>
<button onclick="app.login()">Login</button>
</div>

<!-- MAIN -->

<div id="main" class="app hidden">

<h3 id="name"></h3>

<p>Today Hours: <span id="today">0:00</span></p>

<button id="clockBtn" class="clock-in"
onclick="app.toggleClock()">
<span id="clockText">Clock In</span>
</button>

<textarea id="notes" placeholder="Job notes..."></textarea>

<button onclick="app.showTimesheet()">View Timesheet</button>
<button onclick="app.logout()">Logout</button>

<div id="timesheet" class="hidden">
<h4>Weekly / Monthly</h4>
<table id="table">
<thead>
<tr>
<th>Date</th>
<th>Start</th>
<th>End</th>
<th>Hrs</th>
<th>Notes</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<script>

const GOOGLE_SCRIPT_URL =
'https://script.google.com/macros/s/AKfycbxvRWVHRf_diTDdZ8qp_RPXj4n97SZNb5ePPuALqdBWgH0L1KOxN3UzoYif2Ly5eiOy-Q/exec';

const EMPLOYEES={
'1234':{name:'Dan Halpin'},
'5678':{name:'Paul Read'},
'9012':{name:'Devris Hudaverdi'},
'3456':{name:'Shane Clark'},
'7890':{name:'Jack Saillart'},
'2468':{name:'John Tomlin'}
};

class App{

constructor(){
this.user=null;
this.entry=null;
this.history=JSON.parse(localStorage.getItem('history')||'[]');
}

/* LOGIN */

login(){
const pin=document.getElementById('pin').value;
if(!EMPLOYEES[pin]) return alert('Invalid PIN');

this.user=EMPLOYEES[pin];
localStorage.setItem('user',JSON.stringify(this.user));

document.getElementById('login').classList.add('hidden');
document.getElementById('main').classList.remove('hidden');
document.getElementById('name').innerText=this.user.name;
}

/* CLOCK */

toggleClock(){
if(this.entry) this.clockOut();
else this.clockIn();
}

clockIn(){
this.entry={start:new Date()};
document.getElementById('clockBtn').className='clock-out';
document.getElementById('clockText').innerText='Clock Out';
}

clockOut(){

const end=new Date();
const notes=document.getElementById('notes').value;

const row={
engineer:this.user.name,
date:end.toISOString().split('T')[0],
start:this.entry.start.toLocaleTimeString('en-GB'),
end:end.toLocaleTimeString('en-GB'),
hours:((end-this.entry.start)/36e5).toFixed(2),
notes:notes
};

/* STORE LOCAL */

this.history.push(row);
localStorage.setItem('history',JSON.stringify(this.history));

/* SEND TO GOOGLE */

fetch(GOOGLE_SCRIPT_URL,{
method:'POST',
body:JSON.stringify(row)
});

this.entry=null;
document.getElementById('notes').value='';
document.getElementById('clockBtn').className='clock-in';
document.getElementById('clockText').innerText='Clock In';
}

/* TIMESHEET VIEW */

showTimesheet(){

document.getElementById('timesheet').classList.toggle('hidden');

const tbody=document.querySelector('#table tbody');
tbody.innerHTML='';

this.history.forEach(r=>{
tbody.innerHTML+=`
<tr>
<td>${r.date}</td>
<td>${r.start}</td>
<td>${r.end}</td>
<td>${r.hours}</td>
<td>${r.notes}</td>
</tr>`;
});
}

/* LOGOUT */

logout(){
localStorage.clear();
location.reload();
}

}

const app=new App();

</script>

</body>
</html>
